# SoftLEGS-ROS_Package
ROS Package of the SoftLEGS-Project (see the relative repo)

This package allows to drive the SoftLegs built in laboratory and equipped with the VSA actuators. Just copy all the /src folder inside the /catkin ws workspace and compile it.

NOTE: during the compile process you will probably encounter small errors due to miss packages. After fix them all the nodes will be ready
to go! Please refer to the guide for an overview of the GUIs.

## Repository organization

The repository contains a `src` folder, which is the last
version of the source folder of the *SoftLEGS-Project*.  
The `.zip` file is the old version without the *Push Recovery Controller*.

## Source compilation

The workspace has been developed in ROS-kinetic on Ubuntu 16.04, but it also works for ROS-indigo on Ubuntu 14.04.

If you have problems with the symbolic link `CMakeLists.txt`, which is in the 
`src` folder of the workspace, run the following command

    catkin_init_workspace

This command recreate the simbolic link. Generally you should not have problem 
with it because it is automatically generated by `catkin_make` but in this case
you can have other problems that prevent you to successfully complete the building 
of the workspace.  
The problems can derive from the fact that it is a symbolic link and can give 
trouble when copying the workspace etc...

First of all use *rosdep* to install the dependencies of the project.  
For more information read the [ROS Wiki](http://wiki.ros.org/rosdep).  
The commands are:

    sudo rosdep init
    rosdep update
    rosdep install --from-paths src --ignore-src -r -y

The first command initialize *rosdep*, however you should have it already initialized, the second updates the ROS package names and the last installs dependencies of all packages in the workspace.  
This is a magic command but, I suppose, it looks the *package.xml* for dependencies, so if the original author forgot to update the *package.xml* *rosdep* fails and some dependency will be not installed, e.g. I had to install manually the ros-control package.  
  
Now you have to compile some custom messages and services. I'm not going into the details, but I care to say that generally the compilation order should be managed by the *CMakeLists.txt*. Unfortunatly this is not the case, so let's make it manually. In the base directory of the workspace type:

    catkin_make --pkg qb_device_msgs
    catkin_make --pkg qb_device_srvs

or

    catkin_make qb_device_msgs_gencpp
    catkin_make qb_device_srvs_gencpp

however the first commands should be more appropriate.
Read this [discussion](https://answers.ros.org/question/52744/how-to-specify-dependencies-with-foo_msgs-catkin-packages/) for more informations.  
Now you can make the workspace using:

    catkin_make

## Connecting to the robot

The robot should be 'plug and play' but using the lab computer, the old one left by Gianmaria, can give you some problems. The port value change if it is unplugged and plugged again, e.g. from `/dev/ttyUSB0` to `/dev/ttyUSB2`. If this happens you have to change the port value in:

- IMU port: change the `port` variable in `src/Qb_Legs_Synergies/imu_management/conf/config_imu_management.yaml`.
- motors port: change the connection setting (`openRS485(&comm_settings_t, "/dev/ttyUSBX", 2000000);`, set `X` as the desired value) in `src/Qb_Legs_Synergies/qb_legs_controller/src/qb_legs_controller.cpp`.

To find what port the motor or the IMU are using you have to use some magic functions of qb-move.